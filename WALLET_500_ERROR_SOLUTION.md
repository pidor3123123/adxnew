# Решение ошибки 500 в wallet.php

## Текущая ситуация

✅ Все файлы загружаются успешно
✅ Функция `getAuthUser()` доступна и работает
✅ Проблема не в загрузке файлов

## Вероятная причина

Ошибка 500 возникает **после** успешной загрузки всех файлов, скорее всего в одном из следующих мест:

1. **Вызов `getSupabaseClient()`** - может быть проблема с конфигурацией Supabase
2. **Вызов `getSupabaseUserId($user)`** - может быть проблема, если пользователь не авторизован
3. **Вызов RPC функций Supabase** - может быть проблема с подключением к Supabase

## Решение

### Шаг 1: Проверьте логи сервера

В панели Hostinger:
1. Перейдите в **"Логи"** → **"Error Logs"**
2. Найдите последние записи с упоминанием `wallet.php`
3. Скопируйте последние 20-30 строк логов

Логи покажут точную ошибку, например:
- `Call to undefined function...`
- `Fatal error: Uncaught Exception...`
- `Connection refused...`

### Шаг 2: Проверьте, авторизован ли пользователь

Если вы тестируете без авторизации, `wallet.php` должен вернуть `401 Unauthorized`, а не `500`.

Попробуйте:
1. Войти на сайт
2. Открыть `https://adx.finance/api/wallet.php?action=balances` в браузере (должен быть установлен токен авторизации)

### Шаг 3: Проверьте конфигурацию Supabase

Убедитесь, что в `config/supabase.php` правильно настроены:
- `SUPABASE_URL`
- `SUPABASE_KEY`

### Шаг 4: Временное решение

Если проблема в Supabase, можно временно изменить `wallet.php`, чтобы он возвращал пустой баланс вместо ошибки 500.

## Что проверить прямо сейчас

1. **Логи сервера** - это самый важный источник информации
2. **Авторизация** - убедитесь, что вы авторизованы при тестировании
3. **Конфигурация Supabase** - проверьте настройки в `config/supabase.php`

## Если проблема не решается

Пришлите:
1. Логи сервера (Error Logs)
2. Результат запроса с авторизацией
3. Содержимое `config/supabase.php` (без секретных ключей, только структуру)
