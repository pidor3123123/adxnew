# Руководство по исправлению ошибки 500 в wallet.php

## Проблема

`/api/wallet.php` возвращает HTTP 500 из-за того, что файлы `config/database.php` и `config/supabase.php` не найдены на сервере.

## Решение

### Шаг 1: Диагностика структуры сервера

1. Загрузите файл `check_server_structure.php` на сервер (в корень сайта)
2. Откройте в браузере: `https://adx.finance/check_server_structure.php`
3. Скрипт покажет:
   - Реальную структуру файлов на сервере
   - Где находятся (или должны находиться) файлы config/
   - Все проверенные пути

### Шаг 2: Проверка наличия файлов config/

**Вариант A: Файлы отсутствуют**

Если диагностика показала, что файлы не найдены:

1. Убедитесь, что папка `config/` загружена на сервер
2. Файлы должны находиться в:
   - `public_html/config/database.php`
   - `public_html/config/supabase.php`
   - `public_html/config/webhook.php`

3. Проверьте права доступа:
   ```bash
   chmod 644 config/*.php
   chmod 755 config/
   ```

**Вариант B: Файлы в другом месте**

Если файлы находятся в другом месте, скрипт `check_server_structure.php` покажет реальный путь. Используйте этот путь для обновления `api/wallet.php` (но это маловероятно, так как мы уже добавили поиск по множеству путей).

### Шаг 3: Загрузка исправленного кода

1. Распакуйте ZIP файл `adxfinance-wallet-final-fix-*.zip` на сервере
2. Убедитесь, что папка `config/` присутствует в распакованном архиве
3. Проверьте, что файлы `config/database.php` и `config/supabase.php` существуют

### Шаг 4: Проверка работы

1. Откройте в браузере: `https://adx.finance/test_wallet_api_page.html`
2. Нажмите кнопку "Проверить API wallet"
3. Если всё работает, вы увидите балансы или сообщение об авторизации
4. Если ошибка 500 сохраняется, проверьте логи сервера

### Шаг 5: Проверка логов

Если проблема сохраняется, проверьте логи PHP:

1. В панели Hostinger: **"Логи"** → **"Error Logs"**
2. Ищите записи с префиксом `Wallet.php:`
3. Логи покажут:
   - Какие пути проверялись
   - Где были найдены файлы (или не найдены)
   - Детали ошибок

## Что было исправлено

1. **Улучшен поиск файлов config/**
   - Добавлено больше вариантов путей
   - Использование `DOCUMENT_ROOT` для абсолютных путей
   - Детальное логирование всех проверяемых путей

2. **Улучшен поиск auth.php**
   - Проверка нескольких возможных мест
   - Логирование найденных путей

3. **Добавлена диагностика**
   - Скрипт `check_server_structure.php` для проверки структуры
   - Детальная информация о путях и файлах

## Важные замечания

- **Безопасность**: Удалите `check_server_structure.php` после диагностики!
- **Права доступа**: Убедитесь, что файлы config/ имеют права 644
- **Структура**: Папка config/ должна быть на том же уровне, что и папка api/

## Если проблема не решена

1. Проверьте логи сервера (Error Logs в панели Hostinger)
2. Убедитесь, что файлы config/ действительно загружены
3. Проверьте права доступа к файлам
4. Используйте `check_server_structure.php` для диагностики

## Контакты для поддержки

Если проблема не решается, предоставьте:
- Вывод `check_server_structure.php`
- Логи сервера (Error Logs)
- Скриншот структуры папок в File Manager
